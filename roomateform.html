<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roommate Form</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: #f6f8f9;
        }
        form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-top: 10px;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        button {
            margin-top: 15px;
            padding: 10px;
            background-color: blue;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <form id="roommateForm">
        <label for="name">Unique Id:</label>
        <input type="text" id="name" name="name" required>

        <label for="name1">Name:</label>
        <input type="text" id="name1" name="name1" required>

        <label for="gender">Gender:</label>
        <select id="gender" name="gender" required>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
        </select>

        <label for="hobby">Hobby:</label>
        <input type="text" id="hobby" name="hobby" required>

        <label for="course">Course:</label>
        <select id="course" name="course" required>
            <option value="b.tech">B.Tech</option>
            <option value="b.sc">BSc</option>
            <option value="mba">MBA</option>
            <option value="law">Law</option>
        </select>

        <label for="food">Food Preference:</label>
        <select id="food" name="food" required>
            <option value="Veg">Veg</option>
            <option value="Non-Veg">Non-Veg</option>
            <option value="Both">Both</option>
        </select>

        <label for="bhk">BHK Preference:</label>
        <select id="bhk" name="bhk" required>
            <option value="1BHK">1BHK</option>
            <option value="2BHK">2BHK</option>
            <option value="3BHK">3BHK</option>
        </select>

        <label for="type">Type:</label>
        <select id="type" name="type" required>
            <option value="Single Sharing">Single Sharing</option>
            <option value="Double Sharing">Double Sharing</option>
            <option value="Triple Sharing">Triple Sharing</option>
        </select>

        <label for="note">Additional Note:</label>
        <textarea id="note" name="note" rows="3"></textarea>

        <button type="submit" id="submitBtn">Submit</button>
        <button id="updateBtn">Update</button>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("roommateForm");
            const updateBtn = document.getElementById("updateBtn");
            let userId = null; // Store user ID for updating
        
            form.addEventListener("submit", async function (event) {
                event.preventDefault();
        
                const name = document.getElementById("name").value.trim();
                if (!name) {
                    alert("Unique ID is required.");
                    return;
                }
        
                try {
                    const checkResponse = await fetch(`http://localhost:3019/getUser?name=${name}`);
                    const checkData = await checkResponse.json();
        
                    if (checkResponse.ok && checkData.data) {
                        alert("User already exists.");
                        return;
                    }
                } catch (error) {
                    console.error("Error checking user:", error);
                }
        
                const newUser = {
                    name,
                    name1: document.getElementById("name1").value,
                    gender: document.getElementById("gender").value,
                    hobby: document.getElementById("hobby").value,
                    course: document.getElementById("course").value,
                    food: document.getElementById("food").value,
                    bhk: document.getElementById("bhk").value,
                    type: document.getElementById("type").value,
                    note: document.getElementById("note").value
                };
        
                try {
                    const response = await fetch("http://localhost:3019/submit", {  // ðŸ”¹ Fixed URL
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(newUser)
                    });
        
                    if (response.ok) {
                        alert("User added successfully!");
                        window.location.href = "indexx.html";
                        form.reset();
                    } else {
                        alert("Error adding user.");
                    }
                } catch (error) {
                    console.error("Error adding user:", error);
                }
            });
        
            updateBtn.addEventListener("click", async function (event) {
                event.preventDefault();
                const name = document.getElementById("name").value.trim();
        
                if (!userId) {
                    if (!name) {
                        alert("Please enter a Unique ID to fetch details.");
                        return;
                    }
        
                    try {
                        const response = await fetch(`http://localhost:3019/getUser?name=${name}`);
                        const responseData = await response.json();
        
                        if (response.ok && responseData.data) {
                            const userData = responseData.data;
                            userId = userData._id; // Store ID for update
        
                            document.getElementById("name1").value = userData.name1 || "";
                            document.getElementById("gender").value = userData.gender || "";
                            document.getElementById("hobby").value = userData.hobby || "";
                            document.getElementById("course").value = userData.course || "";
                            document.getElementById("food").value = userData.food || "";
                            document.getElementById("bhk").value = userData.bhk || "";
                            document.getElementById("type").value = userData.type || "";
                            document.getElementById("note").value = userData.note || "";
        
                            updateBtn.textContent = "Save Changes";
                        } else {
                            alert("User not found.");
                        }
                    } catch (error) {
                        console.error("Error fetching user:", error);
                    }
                } else {
                    const updatedUser = {
                        name,
                        name1: document.getElementById("name1").value,
                        gender: document.getElementById("gender").value,
                        hobby: document.getElementById("hobby").value,
                        course: document.getElementById("course").value,
                        food: document.getElementById("food").value,
                        bhk: document.getElementById("bhk").value,
                        type: document.getElementById("type").value,
                        note: document.getElementById("note").value
                    };
        
                    try {
                        const response = await fetch(`http://localhost:3019/roommates/${userId}`, {
                            method: "PUT",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(updatedUser)
                        });
        
                        if (response.ok) {
                            alert("User updated successfully!");
                            location.reload();
                            window.location.href = "indexx.html";
                        } else {
                            alert("Error updating user.");
                        }
                    } catch (error) {
                        console.error("Error updating user:", error);
                    }
                }
            });
        });
        </script>
        
</body>
</html>
